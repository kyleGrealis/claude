---
name: r-package-conventions
description: R package development conventions using usethis workflow, roxygen2 documentation, and CRAN requirements. Use when creating or maintaining R packages, writing documentation, or preparing for CRAN submission.
---

# R Package Development Conventions

## Package Structure

```
packagename/
├── DESCRIPTION
├── NAMESPACE           # Auto-generated by roxygen2
├── LICENSE
├── NEWS.md
├── README.md
├── R/
│   ├── packagename-package.R
│   └── function_name.R
├── man/                # Auto-generated by roxygen2
├── tests/
│   ├── testthat.R
│   └── testthat/
├── vignettes/
└── data-raw/           # Scripts to create data
```

## usethis Workflow

**Initial setup**:
```r
usethis::create_package('packagename')
usethis::use_mit_license()
usethis::use_news_md()
usethis::use_testthat()
usethis::use_package_doc()
```

**Adding functionality**:
```r
usethis::use_test('function_name')
usethis::use_vignette('topic')
```

## DESCRIPTION File

```
Package: packagename
Type: Package
Title: Brief Description (Title Case, No Period)
Version: 0.1.0
Authors@R:
    person("Kyle", "Grealis",
           email = "email@example.com",
           role = c("aut", "cre"),
           comment = c(ORCID = "0000-0000-0000-0000"))
Description: Detailed description with complete sentences and periods.
    Can span multiple lines with proper indentation.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2
Imports:
    dplyr (>= 1.1.0),
    rlang (>= 1.1.0)
Suggests:
    testthat (>= 3.0.0),
    knitr,
    rmarkdown
VignetteBuilder: knitr
URL: https://github.com/user/packagename
BugReports: https://github.com/user/packagename/issues
```

## roxygen2 Documentation

**Required tags for exported functions**:
- `@param` — every parameter
- `@return` — what it returns
- `@examples` — working examples
- `@export` — marks as exported

**Template**:
```r
#' Calculate Summary Statistics
#'
#' Computes mean and standard deviation for a numeric vector.
#'
#' @param x A numeric vector.
#' @param na.rm Logical. Remove NA values? Default `TRUE`.
#'
#' @return Named numeric vector with `mean` and `sd`.
#'
#' @examples
#' summary_stats(c(1, 2, 3, 4, 5))
#'
#' @export
summary_stats <- function(x, na.rm = TRUE) {
  c(mean = mean(x, na.rm = na.rm), sd = sd(x, na.rm = na.rm))
}
```

## NAMESPACE Management

**NEVER edit NAMESPACE manually** — roxygen2 manages it.

- Use `@export` to export functions
- Use `@importFrom pkg function` to import specific functions
- Prefer `package::function()` over `@import pkg`

## Error Handling

Use `rlang::abort()` for errors in packages:

```r
if (!is.numeric(x)) {
  rlang::abort('`x` must be numeric, not {class(x)[1]}')
}
```

## Testing

- One test file per R source file
- Aim for >80% coverage
- Test happy path, edge cases, errors

```r
test_that('function validates input', {
  expect_error(func('string'), 'must be numeric')
})
```

## Version Numbers

Semantic versioning: `Major.Minor.Patch`
- Major: Breaking changes
- Minor: New features (backward compatible)
- Patch: Bug fixes

Development: `0.0.0.9000`, `1.0.0.9000`

## CRAN Submission

**Pre-submission**:
```r
devtools::check()  # 0 errors, 0 warnings, 0 notes
spelling::spell_check_package()
urlchecker::url_check()
```

**Requirements**:
- Examples run in < 5 seconds
- No `\dontrun{}` unless necessary
- Valid URLs
- No hard-coded paths

## Best Practices Summary

1. Use usethis for setup and management
2. Document everything with roxygen2
3. Test thoroughly (>80% coverage)
4. Minimize dependencies
5. Write runnable examples
6. Maintain NEWS.md
7. Never edit NAMESPACE manually
8. Use `rlang::abort()` for errors
